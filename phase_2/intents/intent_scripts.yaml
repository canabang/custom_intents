# ==========================================================
# LOGIQUE DES INTENTS - PHASE 2 (MODULAIRE)
# ==========================================================
# GÃ¨re le multi-piÃ¨ces via dÃ©tection dynamique du satellite.
# Actions directes + Notifications HA (Pas d'Alexa/IA).
# ==========================================================

# ----------------------------------------------------------
# MODULE 1 : Ã‰CLAIRAGE CONTEXTUEL
# ----------------------------------------------------------

TurnOnContextualLight:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: light.turn_on
      target:
        entity_id: "light.hue_{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ðŸ’¡ LumiÃ¨re AllumÃ©e"
        message: "PiÃ¨ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

TurnOffContextualLight:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: light.turn_off
      target:
        entity_id: "light.hue_{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ðŸŒ‘ LumiÃ¨re Ã‰teinte"
        message: "PiÃ¨ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

# ----------------------------------------------------------
# MODULE 2 : VOLETS CONTEXTUELS
# ----------------------------------------------------------

TurnOnContextualCover:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: cover.open_cover
      target:
        entity_id: "cover.vol{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ðŸªŸ Volet Ouvert"
        message: "PiÃ¨ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

TurnOffContextualCover:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: cover.close_cover
      target:
        entity_id: "cover.vol{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ðŸªŸ Volet FermÃ©"
        message: "PiÃ¨ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

# ----------------------------------------------------------
# MODULE 3 : RACCOURCIS (SHORTCUTS)
# ----------------------------------------------------------

StartCoffeeLoop:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: switch.turn_on
      target:
        entity_id: switch.priscafe
    - service: persistent_notification.create
      data:
        title: "â˜• CafÃ© en prÃ©paration"
        message: "CafÃ© lancÃ© (switch.priscafe) | Satellite : `{{ satellite_id }}`"

SetHouseToSleep:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: automation.trigger
      target:
        entity_id: automation.mode_dodo_2
    - service: persistent_notification.create
      data:
        title: "ðŸŒ™ Mode Dodo"
        message: "Activation du dodo (automation.mode_dodo_2) | Satellite : `{{ satellite_id }}`"
