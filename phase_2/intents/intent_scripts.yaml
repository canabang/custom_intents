# ==========================================================
# LOGIQUE DES INTENTS - PHASE 2 (MODULAIRE & GLOBAL)
# ==========================================================
# G√®re le multi-pi√®ces (via satellite) et le global (via groupes).
# ==========================================================

# ----------------------------------------------------------
# MODULE 1 : √âCLAIRAGE
# ----------------------------------------------------------

# --- CONTEXTUEL (Pi√®ce actuelle) ---
TurnOnContextualLight:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: light.turn_on
      target:
        entity_id: "light.hue_{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "üí° Lumi√®re Allum√©e"
        message: "Pi√®ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

TurnOffContextualLight:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: light.turn_off
      target:
        entity_id: "light.hue_{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "üåë Lumi√®re √âteinte"
        message: "Pi√®ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

# --- GLOBAL (Toute la maison) ---
TurnOnAllLights:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    # --- √Ä ADAPTER : Remplacez par votre groupe de lumi√®res global ---
    - service: light.turn_on
      target:
        entity_id: light.hue_all
    # --------------------------------------------------------------
    - service: persistent_notification.create
      data:
        title: "üè† TOUTE LA MAISON Allum√©e"
        message: "Action globale re√ßue via satellite : `{{ satellite_id }}`"

TurnOffAllLights:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    # --- √Ä ADAPTER : Remplacez par votre groupe de lumi√®res global ---
    - service: light.turn_off
      target:
        entity_id: light.hue_all
    # --------------------------------------------------------------
    - service: persistent_notification.create
      data:
        title: "üè† TOUTE LA MAISON √âteinte"
        message: "Action globale re√ßue via satellite : `{{ satellite_id }}`"


# ----------------------------------------------------------
# MODULE 2 : VOLETS
# ----------------------------------------------------------

# --- CONTEXTUEL (Pi√®ce actuelle) ---
TurnOnContextualCover:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: cover.open_cover
      target:
        entity_id: "cover.vol{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ü™ü Volet Ouvert"
        message: "Pi√®ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

TurnOffContextualCover:
  action:
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: cover.close_cover
      target:
        entity_id: "cover.vol{{ piece }}"
    - service: persistent_notification.create
      data:
        title: "ü™ü Volet Ferm√©"
        message: "Pi√®ce : **{{ piece }}** | Satellite : `{{ satellite_id }}`"

# --- GLOBAL (Toute la maison) ---
TurnOnAllCovers:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    # --- √Ä ADAPTER : Remplacez par votre groupe de volets global ---
    - service: cover.open_cover
      target:
        entity_id: cover.volets
    # --------------------------------------------------------------
    - service: persistent_notification.create
      data:
        title: "üè† TOUS LES VOLETS Ouverts"
        message: "Action globale re√ßue via satellite : `{{ satellite_id }}`"

TurnOffAllCovers:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    # --- √Ä ADAPTER : Remplacez par votre groupe de volets global ---
    - service: cover.close_cover
      target:
        entity_id: cover.volets
    # --------------------------------------------------------------
    - service: persistent_notification.create
      data:
        title: "üè† TOUS LES VOLETS Ferm√©s"
        message: "Action globale re√ßue via satellite : `{{ satellite_id }}`"


# ----------------------------------------------------------
# MODULE 3 : RACCOURCIS (SHORTCUTS)
# ----------------------------------------------------------

StartCoffeeLoop:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: switch.turn_on
      target:
        entity_id: switch.priscafe
    - service: persistent_notification.create
      data:
        title: "‚òï Caf√© en pr√©paration"
        message: "Caf√© lanc√© (switch.priscafe) | Satellite : `{{ satellite_id }}`"

SetHouseToSleep:
  action:
    - variables:
        satellite_id: "{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}"
    - service: automation.trigger
      target:
        entity_id: automation.mode_dodo_2
    - service: persistent_notification.create
      data:
        title: "üåô Mode Dodo"
        message: "Activation du dodo (automation.mode_dodo_2) | Satellite : `{{ satellite_id }}`"
