# ==========================================================
# TEST 8 : SENSOR AVEC M√âMOIRE (TRIGGER-BASED)
# ==========================================================
# Solution au probl√®me de timing : le sensor RETIENT la valeur
# au lieu de la perdre quand le satellite repasse en idle
# ==========================================================

DiagnosticSatellite:
  action:
    - service: persistent_notification.create
      data:
        title: "üéØ Test 8 : Sensor M√©moris√©"
        message: >
          **Sensor satellite_actif_memorise :**
          
          Pi√®ce d√©tect√©e : `{{ states('sensor.satellite_actif_memorise') }}`
          
          Satellite ID : `{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}`
          
          Echo associ√© : `{{ state_attr('sensor.satellite_actif_memorise', 'echo') }}`
          
          Timestamp : `{{ state_attr('sensor.satellite_actif_memorise', 'timestamp') }}`
          
          ---
          
          ‚úÖ Sensor trigger-based qui RETIENT la valeur !

TurnOnContextualLight:
  action:
    # Utilisation du sensor m√©moris√©
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
    
    # Allumage de la lumi√®re
    - service: light.turn_on
      target:
        entity_id: "light.hue_{{ piece }}"
    
    # Confirmation
    - service: persistent_notification.create
      data:
        title: "üí° Lumi√®re Contextuelle (M√©moris√©)"
        message: >
          Lumi√®re allum√©e dans : **{{ piece }}**
          
          Satellite : `{{ state_attr('sensor.satellite_actif_memorise', 'satellite_id') }}`
          
          Timestamp : `{{ state_attr('sensor.satellite_actif_memorise', 'timestamp') }}`

TurnOffContextualLight:
  action:
    # Utilisation du sensor m√©moris√©
    - variables:
        piece: "{{ states('sensor.satellite_actif_memorise') | lower }}"
    
    # Extinction de la lumi√®re
    - service: light.turn_off
      target:
        entity_id: "light.hue_{{ piece }}"
    
    # Confirmation
    - service: persistent_notification.create
      data:
        title: "üí° Lumi√®re √âteinte (M√©moris√©)"
        message: "Lumi√®re √©teinte dans : **{{ piece }}**"
